<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Madanur Consumer Information</title>
   <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div class="card">
      <h2>Consumer Search</h2>
      <label>Please enter Service No</label>
      <div class="search-row">
        <input type="number" id="ssNo" placeholder="Short Service No" min="0" inputmode="numeric" />
        <button onclick="search()">Search</button>
      </div>
      <div id="result"></div>
    </div>

    <script>
      function search() {
        const ssNo = document.getElementById('ssNo').value.trim();
        if (!ssNo) { alert('Enter a Short Service No'); return; }
        google.script.run
          .withSuccessHandler(showStackedTable)
          .withFailureHandler(showError)
          .lookup(ssNo);
      }

      function showStackedTable(obj) {
        const div = document.getElementById('result');
        if (!obj) {
          div.innerHTML = '<div class="error">No record found for this Short Service No.</div>';
          return;
        }
        let imgUrl = '';
        const urlIdx = obj.headers.indexOf('Copiable URL');
        if (urlIdx > -1) imgUrl = (obj.row[urlIdx] || '').trim();

        let html = '<table>';
        obj.headers.forEach((hdr, idx) => {
          if (hdr.trim().toLowerCase() === 'short service no') return;
          let cell = obj.row[idx] || '';
          if (hdr === 'Copiable URL') {
            html += `<tr><th>Link<span class="pin">${pinSvg()}</span></th><td>${cell}</td></tr>`;
          } else if (hdr === 'Map Link') {
            const link = imgUrl
              ? `<a class="mapLink" href="${imgUrl}" target="_blank" rel="noopener">View Location</a>`
              : '';
            html += `<tr><th>Navigation</th><td>${link}</td></tr>`;
          } else {
            html += `<tr><th>${hdr}</th><td>${cell}</td></tr>`;
          }
        });
        html += '</table>';
        div.innerHTML = html;
      }

      function showError(err) {
        document.getElementById('result').innerHTML = '<div class="error">Server error: ' + err.message + '</div>';
      }

      function pinSvg() {
        return `<svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`;
      }
    </script>
  </body>
</html>
